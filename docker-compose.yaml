version: '3'

networks:
  insta_spring_net:
    driver: bridge

services:
  insta_nginx:
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - insta_spring_net
    depends_on:
      - insta_spring
    volumes:
      - ./default.conf:/etc/nginx/conf.d/default.conf
    image: nginx:1.22
    container_name: insta_spring_nginx_container
    ports:
      - 8089:80
    restart: always

  insta_spring:
    networks:
      - insta_spring_net
    depends_on:
      - mariadb
    build: ./
    volumes:
      - ./:/app/
    image: "insta_spring_app"
    container_name: insta_spring_app_container
    ports:
      - 8082:8080
    restart: always
  phpmyadmin:
    image: phpmyadmin/phpmyadmin:5.2.0
    container_name: insta_phpmyadmin_container
    depends_on:
      - mariadb
    links:
      - mariadb
    environment:
      PMA_HOST: mariadb
      PMA_PORT: 3306
      PMA_ARBITRARY: 1
    restart: always
    networks:
      - insta_spring_net
    ports:
      - 8081:80
  mariadb:
    container_name: insta_mariadb_container
    image: mariadb:10.8.3
    ports:
      - 3307:3306
    volumes:
#      - ./db/conf.d:/etc/mysql/conf.d
      - ./db/data:/var/lib/mysql
#      - ./db/initdb.d:/docker-entrypoint-initdb.d
    env_file: .env
    environment:
      TZ: Asia/Seoul
    networks:
      - insta_spring_net
    restart: always
